#!/bin/zsh

# Notification
/usr/libexec/xfce4/notifyd/xfce4-notifyd &

# Transparency
picom --fading --inactive-opacity=1 &

# Sound notification
volnoti &

# Clipboard manager
parcellite &

# Authentication agent
/usr/libexec/polkit-gnome-authentication-agent-1 &

# Keybase
keybase service &

dbus-update-activation-environment --systemd DISPLAY
eval $(/usr/bin/gnome-keyring-daemon --start)
export SSH_AUTH_SOCK

# Empty trash
gio trash --empty

if [[ -v IS_WORKSTATION ]]; then
    firefox &
    discord &
    alacritty --class "dev-term,dev-term" --working-directory ~/Dev/ &
    alacritty --class "utility-term,utility-term" --working-directory ~/den-test/ &
else
    # Power manager + battery and light tray
    # Tray icon is enabled in `xfce4-power-manager-settings`
    xfce4-power-manager &

    # Bluetooth
    blueberry-tray &
fi

# delayed startup
(
    sleep 10

    # title watcher must be started after i3blocks to avoid some issues
    ~/.local/wm/i3/window-title-watcher &

    fcitx &

    if [[ -v IS_WORKSTATION ]]; then
        xrandr --output DP-1-4 --primary --auto --pos 1920x0 \
               --output DP-1-6           --auto --pos 0x0    \
               --output DP-1             --auto --pos 3840x0

        # move startup applications to a specific workspace
        i3-msg '[class="firefox"]' move window to workspace 5
        i3-msg '[class="dev-term"]' move window to workspace 3
        i3-msg '[class="utility-term"]' move window to workspace 1
        i3-msg '[class="Microsoft Teams.*"]' move window to workspace 10
    else
        # make screen HOT
        redshift-gtk -l 45.5:-73.5 & # Canada, Montreal

        # LXDE network applet
        nm-applet &
    fi

    # Background
    $HOME/.local/wm/i3/set_random_bg &
) &
